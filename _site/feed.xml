<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-07-18T12:27:08+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Dorian Frances</title><subtitle>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</subtitle><entry><title type="html">How to bootstrap a Spring boot project using Clean Architecture</title><link href="http://localhost:4000/2023/07/18/How-to-bootstrap-a-Spring-boot-project-using-Clean-Architecture.html" rel="alternate" type="text/html" title="How to bootstrap a Spring boot project using Clean Architecture" /><published>2023-07-18T00:00:00+02:00</published><updated>2023-07-18T00:00:00+02:00</updated><id>http://localhost:4000/2023/07/18/How-to-bootstrap-a-Spring-boot-project-using-Clean-Architecture</id><content type="html" xml:base="http://localhost:4000/2023/07/18/How-to-bootstrap-a-Spring-boot-project-using-Clean-Architecture.html"><![CDATA[<h1 id="introduction">Introduction</h1>

<p>Hello everyone ! Today we will talk about Spring and Java. More specifically, Iâ€™ll talk about how to bootstrap a spring boot project using Hexagonal
Architecture. Spring boot is a very straightforward framework, but creating a very clean bootstrap using clean architecture can be disruptive.</p>

<p>Hexagonal Architecture bring to the fore many concepts like :</p>

<ul>
  <li>Testability</li>
  <li>Separation of business code and technical implementation</li>
  <li>Code modularity / scalability</li>
</ul>

<p>Many of you could think that using hexagonal architecture to start a little project can be a little bit wordy and you are not completely wrong but in
the other hand, it also provides a comprehensive structure of your project.</p>

<blockquote>
  <p>ðŸ‘‰ Also, I would not lie about the fact that <strong>I do not have enough knowledge about all the different kind of architecture</strong>. Here, I simply suggest
a way of bootstrapping a project using hexagonal architecture. Feel free not to use it if you donâ€™t want to. ðŸ˜‰</p>
</blockquote>

<h1 id="github-repository">Github repository</h1>

<p>You can find the entire bootstrap project by clicking ðŸ“‚ <a href="https://github.com/dorian-frances/df-java-template">this link</a>. <strong>Feel free to use it as you
want !</strong></p>

<h1 id="initialize-a-project">Initialize a project</h1>

<p>The first thing we need to do is to create our spring-boot project (I used <strong>maven</strong> here as my package manager).</p>

<p>Using IntelliJ IDEA, you might come up with something like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
â”œâ”€â”€ pom.xml
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚Â Â  â”œâ”€â”€ java
    â”‚Â Â  â”‚Â Â  â””â”€â”€ org
    â”‚Â Â  â”‚Â Â      â””â”€â”€ example
    â”‚Â Â  â”‚Â Â          â””â”€â”€ Main.java
    â”‚Â Â  â””â”€â”€ resources
    â””â”€â”€ test
        â””â”€â”€ java
</code></pre></div></div>

<h1 id="target-project">Target project</h1>

<p>The application we want to create here is pretty basic, we will build a <strong>RestAPI</strong> with <strong>one endpoint</strong> that will allow us to <strong>retrieve a user</strong> in
a <strong>PostgreSQL database</strong> given its ID.</p>

<p>Going further, we pretty much see the elements that we will need:</p>

<ul>
  <li>A <strong>RestAPI</strong> implementing the route to retrieve our <em>user</em></li>
  <li>Some <strong>business code logic</strong></li>
  <li>A local <strong>PostgreSQL</strong> database</li>
  <li>An <strong>ORM</strong>, simplifying database requests</li>
</ul>

<h1 id="clean-architecture">Clean Architecture</h1>

<p>For now, we see that our code structure does not fit hexagonal architecture. To solve this, we want our code to contain those elements:</p>

<ul>
  <li>An <strong>application</strong> folder: this folder will contain all the technical implementation that will consume our application (in our case, the RestAPI
that we will build).</li>
  <li>An <strong>infrastructure</strong> folder: this folder will contain all the technical implementation that will be used by our application (in our case, the
PostgreSQL implementation).</li>
  <li>A <strong>domain</strong> folder: this is the most important folder. This is where all your business code has to be. All the code that contains <strong>added value</strong>
has to be in here.</li>
  <li>A <strong>bootstrap</strong> folder: this folder contains all the code that allow us to start our application, this is where we initialize it.</li>
</ul>

<blockquote>
  <p>ðŸ‘‰ <strong>IMPORTANT</strong>: <em>domain-driven-development</em> state that our domain needs to be independent from all technical implementation. The fact is, technical
implementation <strong>may change</strong> over time, your <strong>business code usually do not</strong>. However, our domain still needs to communicate with the other parts
of
our application, that is why, we will create <em>application-domain</em> and <em>domain-infrastructure</em> interfaces. by doing this, we ensure better modularity
and better testability of our application (weâ€™ll see this later in this article).</p>
</blockquote>

<p>Now, our application should look like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
â”œâ”€â”€ application
â”‚Â Â  â”œâ”€â”€ pom.xml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â”œâ”€â”€ main
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ org.example
â”‚Â Â      â”‚Â Â  â””â”€â”€ resources
â”‚Â Â      â””â”€â”€ test
â”‚Â Â          â””â”€â”€ java
â”œâ”€â”€ bootstrap
â”‚Â Â  â”œâ”€â”€ pom.xml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â”œâ”€â”€ main
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ org
â”‚Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ example
â”‚Â Â      â”‚Â Â  â”‚Â Â          â””â”€â”€ Main.java
â”‚Â Â      â”‚Â Â  â””â”€â”€ resources
â”‚Â Â      â””â”€â”€ test
â”‚Â Â          â””â”€â”€ java
â”œâ”€â”€ domain
â”‚Â Â  â”œâ”€â”€ pom.xml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â”œâ”€â”€ main
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ org
â”‚Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ example
â”‚Â Â      â”‚Â Â  â””â”€â”€ resources
â”‚Â Â      â””â”€â”€ test
â”‚Â Â          â””â”€â”€ java
â”œâ”€â”€ infrastructure
â”‚Â Â  â”œâ”€â”€ pom.xml
â”‚Â Â  â””â”€â”€ src
â”‚Â Â      â”œâ”€â”€ main
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ org
â”‚Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ example
â”‚Â Â      â”‚Â Â  â””â”€â”€ resources
â”‚Â Â      â””â”€â”€ test
â”‚Â Â          â””â”€â”€ java
â””â”€â”€ pom.xml
</code></pre></div></div>

<p>We will now go through all the different folders to understand how we implemented each of them.</p>

<h1 id="deep-diving-in-our-project-structure">Deep diving in our project structure</h1>

<h2 id="application">Application</h2>

<p>After that we implemented our rest-api-adapter, the folder has this structur:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>application
â”œâ”€â”€ pom.xml
â”œâ”€â”€ rest-api-adapter
Â Â   â”œâ”€â”€ pom.xml
Â Â   â”œâ”€â”€ src
Â Â   â”œâ”€â”€ main
Â Â   â”‚Â Â  â”œâ”€â”€ java
Â Â   â”‚Â Â  â”‚Â Â  â””â”€â”€ io.df.java.template.application.rest.api.adapter
Â Â   â”‚Â Â  â”‚Â Â                                  â”œâ”€â”€ controller
Â Â   â”‚Â Â  â”‚Â Â                                  â”‚Â Â  â””â”€â”€ UserController.java
Â Â   â”‚Â Â  â”‚Â Â                                  â””â”€â”€ mapper
Â Â   â”‚Â Â  â”‚Â Â                                      â”œâ”€â”€ DfExceptionMapper.java
Â Â   â”‚Â Â  â”‚Â Â                                      â””â”€â”€ UserMapper.java
Â Â   â”‚Â Â  â””â”€â”€ resources
Â Â   â””â”€â”€ test
Â Â        â””â”€â”€ java
</code></pre></div></div>

<p>The two main things that weâ€™ll talk about here are our <code class="language-plaintext highlighter-rouge">UserController</code> and the <code class="language-plaintext highlighter-rouge">UserMapper</code> .</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Tags</span><span class="o">(</span><span class="nd">@Tag</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"User"</span><span class="o">))</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="kd">implements</span> <span class="nc">UserApi</span> <span class="o">{</span>

    <span class="kd">final</span> <span class="nc">UserFacade</span> <span class="n">userFacade</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">GetUserDTO</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="no">UUID</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userFacade</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="n">getUserFromDomainToResponse</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">DfException</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">mapDfExceptionToContract</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">errorToGetUserDTO</span><span class="o">(</span><span class="n">exception</span><span class="o">),</span> <span class="n">exception</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is the implementation of our user endpoint. We can see that this controller <strong>implements</strong> the <code class="language-plaintext highlighter-rouge">UserApi</code>. This, is an interface generated by
the <a href="https://openapi-generator.tech/docs/plugins">openapi-generator</a> used in our <em>contract-first</em> methodology.</p>

<blockquote>
  <p>ðŸ‘‰ If you look at the <strong>README.md</strong> file in the github repository, you will get an explanation about using <em>contract-first</em> methodology. Basically,
it allows us to define (in a contract) the different endpoints of our API that will be generated during <strong>build</strong> so that we only need to implement
them after.</p>
</blockquote>

<p>Anyway, we notice different thins in this controller, the use of a <code class="language-plaintext highlighter-rouge">UserFacade</code> that we pass in the constructor of our controller (notice
the <code class="language-plaintext highlighter-rouge">@AllArgsConstructor</code> decorator here). As I explained <a href="#clean-architecture">here</a>, we pass an interface to our controller that our <strong>domain</strong> will
then implement to increase modularity / testability of our code and independence of our <em>domain</em>.</p>

<p>The second thing is the use of <code class="language-plaintext highlighter-rouge">getUserFromDomainToResponse</code> method from the <code class="language-plaintext highlighter-rouge">UserMapper</code> class. We really want to make a distinction between <strong>domain
models</strong> and <strong>API entity</strong>. That is the purpose of the mapper here.</p>

<blockquote>
  <p>ðŸ‘‰ Weâ€™ll talk about the <code class="language-plaintext highlighter-rouge">DfExceptionMapper</code> class in the <a href="#domain">domain section</a>.</p>
</blockquote>

<h2 id="domain">Domain</h2>

<p>Our domain looks like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>domain
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
  Â Â  â”œâ”€â”€ main
  Â Â  â”‚Â Â  â”œâ”€â”€ java
  Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ io.df.java.template.domain
  Â Â  â”‚Â Â  â”‚Â Â                      â”œâ”€â”€ exception
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â”œâ”€â”€ DfException.java
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â””â”€â”€ DfExceptionCode.java
  Â Â  â”‚Â Â  â”‚Â Â                      â”œâ”€â”€ model
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â””â”€â”€ User.java
  Â Â  â”‚Â Â  â”‚Â Â                      â”œâ”€â”€ port
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â”œâ”€â”€ in
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â”‚Â Â  â””â”€â”€ UserFacade.java
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â  â””â”€â”€ out
  Â Â  â”‚Â Â  â”‚Â Â                      â”‚Â Â      â””â”€â”€ UserStoragePort.java
  Â Â  â”‚Â Â  â”‚Â Â                      â””â”€â”€ service
  Â Â  â”‚Â Â  â”‚Â Â                          â””â”€â”€ UserService.java
  Â Â  â”‚Â Â  â””â”€â”€ resources
  Â Â  â””â”€â”€ test
  Â Â      â””â”€â”€ java
  Â Â  Â Â  Â Â  â””â”€â”€ io.df.java.template.domain
  Â Â                              â””â”€â”€ service
  Â Â                                  â””â”€â”€ UserServiceTest.java
</code></pre></div></div>

<p>First, our <code class="language-plaintext highlighter-rouge">UserService</code> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="kd">implements</span> <span class="nc">UserFacade</span> <span class="o">{</span>

    <span class="nc">UserStoragePort</span> <span class="n">userStoragePort</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="no">UUID</span> <span class="n">userId</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">DfException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">optionalUser</span> <span class="o">=</span> <span class="n">userStoragePort</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">userId</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">optionalUser</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="nc">DfException</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">dfExceptionCode</span><span class="o">(</span><span class="nc">DfExceptionCode</span><span class="o">.</span><span class="na">USER_NOT_FOUND_EXCEPTION</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">errorMessage</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Failed to find user with id %s"</span><span class="o">,</span> <span class="n">userId</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">optionalUser</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This is the service that implements the interface called in the <code class="language-plaintext highlighter-rouge">UserController</code> . The same way, this service calls another interface to fetch the
user that we want in the database.</p>

<p>All those interfaces are called <code class="language-plaintext highlighter-rouge">port</code> and you can see that they are defined in our domain wearing the designation <code class="language-plaintext highlighter-rouge">port.in</code> and <code class="language-plaintext highlighter-rouge">port.out</code>.</p>

<p>In the domain, we can also find our <code class="language-plaintext highlighter-rouge">UserModel</code> . This is the object that will be manipulated in our domain. In there we can not find entities from
our API or our database. This would break hexagonal architecture principles.</p>

<p>Finally, we also see an <code class="language-plaintext highlighter-rouge">exception</code> folder. In this project, we defined our own exceptions allowing us to customize the exceptions that we wanna
throw. For example, in our <code class="language-plaintext highlighter-rouge">UserService</code> if we threw an <code class="language-plaintext highlighter-rouge">HttpNotFoundException</code> , this would mean that our domain is aware that we are using an HTTP
protocol as a technical implementation. Again, this breaks <em>hexagonal architecture</em> and <em>domain-driven-development</em> principles. To avoid that, we
throw customized exceptions that weâ€™ll map INSIDE of our <code class="language-plaintext highlighter-rouge">rest-api-adapter</code> (this is the purpose of the <code class="language-plaintext highlighter-rouge">DfExceptionMapper</code> class in our <code class="language-plaintext highlighter-rouge">application</code>
folder).</p>

<p>This way, our domain only knows that he has to throw an exception without knowing how those are handled in the technical implementations.</p>

<h2 id="infrastructure">Infrastructure</h2>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infrastructure
â”œâ”€â”€ pom.xml
â”œâ”€â”€ postgres-adapter
  Â Â  â”œâ”€â”€ pom.xml
  Â Â  â”œâ”€â”€ src
    Â Â  Â Â  â”œâ”€â”€ main
    Â Â  Â Â  â”‚Â Â  â”œâ”€â”€ java
    Â Â  Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ io.df.java.template.infrastructure
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                      â””â”€â”€ postgres
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ adapter
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”‚Â Â  â””â”€â”€ PostgresUserAdapter.java
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ configuration
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”‚Â Â  â””â”€â”€ PostgresConfiguration.java
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ entity
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”‚Â Â  â””â”€â”€ UserEntity.java
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ mapper
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â”‚Â Â  â””â”€â”€ UserEntityMapper.java
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                          â””â”€â”€ repository
    Â Â  Â Â  â”‚Â Â  â”‚Â Â                              â””â”€â”€ UserRepository.java
    Â Â  Â Â  â”‚Â Â  â””â”€â”€ resources
    Â Â  Â Â  â”‚Â Â      â””â”€â”€ db.changelog
    Â Â  Â Â  â”‚Â Â          â”œâ”€â”€ changelogs
    Â Â  Â Â  â”‚Â Â          â”‚ Â Â  â””â”€â”€ 00000000_init_user_schema.sql
    Â Â  Â Â  â”‚Â Â          â””â”€â”€ db.changelog-master.yaml
    Â Â  Â Â  â””â”€â”€ test
    Â Â  Â Â     â””â”€â”€ java
</code></pre></div></div>

<p>As mentioned earlier, this is where all technical implementations <strong>used by</strong> our application should be. Thus, in our case, we can only find
our <code class="language-plaintext highlighter-rouge">postgres-adapter</code> designed to handle relation with our database.</p>

<p>In this project, we used <a href="https://hibernate.org/">Hibernate</a> for our ORM along with <a href="https://www.liquibase.org/">Liquibase</a> to handle database
migration (I will not deep dive into the use of liquibase, but that explains the presence of the <code class="language-plaintext highlighter-rouge">db.changelog</code> directory in this adapter).</p>

<p>Again we can find a <code class="language-plaintext highlighter-rouge">mapper</code> directory to handle mapping between <em>postgres entities</em> and <em>domain models</em>.</p>

<p>Our <code class="language-plaintext highlighter-rouge">PostgresUserAdapter</code> class looks like that:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostgresUserAdapter</span> <span class="kd">implements</span> <span class="nc">UserStoragePort</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="no">UUID</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">userId</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="nl">UserEntityMapper:</span><span class="o">:</span><span class="n">fromEntityToDomain</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>And the configuration of the entire module is:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@EnableJpaAuditing</span>
<span class="nd">@EntityScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span><span class="s">"io.df.java.template.infrastructure.postgres.entity"</span><span class="o">})</span>
<span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span><span class="s">"io.df.java.template.infrastructure.postgres.repository"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostgresConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">PostgresUserAdapter</span> <span class="nf">postgresUserAdapter</span><span class="o">(</span><span class="kd">final</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PostgresUserAdapter</span><span class="o">(</span><span class="n">userRepository</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We define here the packages where Spring will be able to find our <code class="language-plaintext highlighter-rouge">Entities</code> and <code class="language-plaintext highlighter-rouge">JpaRepositories</code> .</p>

<h2 id="bootstrap">Bootstrap</h2>

<p>Finally, the bootstrap folder. As we passed interfaces as dependencies along all our application, we now have to tell our application which classed
should implement this or this interface. This is done during the runtime of our application through this <code class="language-plaintext highlighter-rouge">bootstrap</code> folder.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootstrap
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
Â Â   â”œâ”€â”€ main
Â Â   â”‚Â Â  â”œâ”€â”€ java
Â Â   â”‚Â Â  â”‚Â Â  â””â”€â”€ io.df.java.template.bootstrap
Â Â   â”‚Â Â  â”‚Â Â                      â”œâ”€â”€ DfJavaTemplateApplication.java
Â Â   â”‚Â Â  â”‚Â Â                      â””â”€â”€ configuration
Â Â   â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ DfJavaTemplateConfiguration.java
Â Â   â”‚Â Â  â”‚Â Â                          â”œâ”€â”€ DomainConfiguration.java
Â Â   â”‚Â Â  â”‚Â Â                          â””â”€â”€ RestApiConfiguration.java
Â Â   â”‚Â Â  â””â”€â”€ resources
Â Â   â”‚Â Â      â””â”€â”€ application.yaml
Â Â   â””â”€â”€ test
Â Â       â”œâ”€â”€ java
Â Â       |Â Â  â””â”€â”€ io.df.java.template.bootstrap
Â Â       â”‚Â Â                      â”œâ”€â”€ DfJavaTemplateITApplication.java
Â Â       â”‚Â Â                      â””â”€â”€ it
Â Â       â”‚Â Â                          â”œâ”€â”€ AbstractDfJavaTemplateBackForFrontendApiIT.java
Â Â       â”‚Â Â                          â””â”€â”€ UserApiIT.java
Â Â       â””â”€â”€ resources
Â Â           â””â”€â”€ application-it.yaml
</code></pre></div></div>

<p>We can see in the structure of this folder different configuration files. Indeed, we will find one configuration file for our domain folder and one
for each adapters of our application (you can find the configuration folder of our <code class="language-plaintext highlighter-rouge">postgres-adapter</code> in the adapter itself).</p>

<p>Our <code class="language-plaintext highlighter-rouge">DfJavaTemplateApplication</code> class will then, looks like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableConfigurationProperties</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="nc">DfJavaTemplateConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">DomainConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">PostgresConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">RestApiConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="nd">@Slf4j</span>
<span class="nd">@EnableAsync</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DfJavaTemplateApplication</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">DfJavaTemplateApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>ðŸ‘‰ Do not forget to import all of your application configurations in the startup class so that Spring can find them and initialize each of the
defined beans.</p>
</blockquote>

<p>For example, the dependency injection for our <code class="language-plaintext highlighter-rouge">RestApiConfiguration</code> is:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RestApiConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">UserController</span> <span class="nf">userController</span><span class="o">(</span><span class="kd">final</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">UserController</span><span class="o">(</span><span class="n">userService</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="testing-strategy">Testing strategy</h1>

<p>Obviously, we can not forget to test our application. That is why, in this project, you will find to types of tests.</p>

<h2 id="unit-tests">Unit Tests</h2>

<p>An example of unit test is present in our domain folder. This type of tests are used to validate that our application behave as we want it to.</p>

<blockquote>
  <p>ðŸ‘‰ For these tests, we do not want to reach technical implementations. Thus, weâ€™ll have to <em>mock</em> every call to technical implementations.
Fortunately, thanks to the use of interfaces, it is really easy to do.</p>
</blockquote>

<p>For example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">should_return_user_given_a_user_id</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">DfException</span> <span class="o">{</span>
        <span class="c1">// Given</span>
        <span class="kd">final</span> <span class="no">UUID</span> <span class="n">userIdFake</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">usernameFake</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="na">ancient</span><span class="o">().</span><span class="na">god</span><span class="o">();</span>

        <span class="c1">// When</span>
        <span class="n">when</span><span class="o">(</span><span class="n">userStoragePortMock</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">userIdFake</span><span class="o">))</span>
                <span class="o">.</span><span class="na">thenReturn</span><span class="o">(</span><span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">id</span><span class="o">(</span><span class="n">userIdFake</span><span class="o">).</span><span class="na">username</span><span class="o">(</span><span class="n">usernameFake</span><span class="o">).</span><span class="na">build</span><span class="o">()));</span>
        <span class="kd">final</span> <span class="nc">User</span> <span class="n">resultUser</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">userIdFake</span><span class="o">);</span>

        <span class="c1">// Then</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">resultUser</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">userIdFake</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">resultUser</span><span class="o">.</span><span class="na">getUsername</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">usernameFake</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="integration-tests">Integration tests</h2>

<p>Those tests are different. <strong>They also have more value</strong> as they test the behaviour of our application <strong>WITH</strong> the use of technical implementations.
Consequently, <strong>they are more difficult to write</strong>. Indeed, we need to fake the startup of our application in order to enable us to fake some calls on
our API.</p>

<p>Youâ€™ll find an example of integration test file in the bootstrap folder.</p>

<h1 id="continuous-integration-ci">Continuous Integration (CI)</h1>

<p>We also integrated a <code class="language-plaintext highlighter-rouge">.circleci</code> folder along with a <code class="language-plaintext highlighter-rouge">config.yml</code> file in this project.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="m">2.1</span>
<span class="na">machine</span><span class="pi">:</span> <span class="kc">true</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-and-test</span><span class="pi">:</span>
    <span class="na">machine</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ubuntu-2004:202107-02</span>
      <span class="na">docker_layer_caching</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Install OpenJDK </span><span class="m">17</span>
          <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">sudo apt-get update &amp;&amp; sudo apt-get install openjdk-17-jdk</span>
            <span class="s">sudo update-alternatives --set java /usr/lib/jvm/java-17-openjdk-amd64/bin/java</span>
            <span class="s">sudo update-alternatives --set javac /usr/lib/jvm/java-17-openjdk-amd64/bin/javac</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Generate cumulative pom.xml checksum</span>
          <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">find . -type f -name "pom.xml" -exec sh -c "sha256sum {} &gt;&gt; ~/pom-checksum.tmp" \;</span>
            <span class="s">sort -o ~/pom-checksum ~/pom-checksum.tmp</span>
      <span class="pi">-</span> <span class="na">restore_cache</span><span class="pi">:</span>
          <span class="na">keys</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">df-java-template-multi-module-mvn-</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">./mvnw install -T 12 -DskipTests -DskipITs</span>
      <span class="pi">-</span> <span class="na">save_cache</span><span class="pi">:</span>
          <span class="na">paths</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">~/.m2</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">df-java-template-multi-module-mvn-</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Unit Tests</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">./mvnw test -T </span><span class="m">12</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Integration Tests</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">./mvnw integration-test -T </span><span class="m">12</span>

<span class="na">workflows</span><span class="pi">:</span>
  <span class="na">build-test-deploy</span><span class="pi">:</span>
    <span class="na">jobs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">build-and-test</span>
</code></pre></div></div>

<p>The important things to see here are:</p>

<ul>
  <li>The use of a real machine on CircleCI. As we used <a href="https://java.testcontainers.org/">testcontainers</a> in order to make our integration tests, we have
to use a real machine for our CI because we obviously can not launch a container image (our integration test container) inside of another image (the
CI image).</li>
  <li>The workflow: basically, only one job is present in this configuration file and it does the following steps:
    <ul>
      <li>Checkout the project on Github</li>
      <li>Install Java OpenJDK 17</li>
      <li>Restore cache</li>
      <li>Build the project</li>
      <li>Save cache</li>
      <li>Run the unit tests</li>
      <li>Run the integration tests</li>
    </ul>
  </li>
</ul>

<h1 id="conclusion">Conclusion</h1>

<p>Though this article, I explained how I used <em>hexagonal architecture</em> and <em>domain-driven-development</em> to create my spring-boot project since I started
developing. Of course, I only have few years of experience, thus, I do not have much knowledge about other code architectures. However, I find this
architecture really educational and made me understand many key concepts of application design.</p>

<p>Do not hesitate to give me your feedback about this and if you want to share your knowledge about everything, you are well welcome ðŸ˜‰.</p>]]></content><author><name></name></author><category term="bootstrap" /><category term="architecture" /><summary type="html"><![CDATA[In this article, we explore the power of Hexagonal Architecture in combination with Spring Boot and Java. Discover how this architectural pattern enhances testability, separates business code from technical implementation, and promotes code modularity and scalability. While applying Hexagonal Architecture may initially seem verbose, its benefits offer a comprehensive and clean structure for your projects.]]></summary></entry><entry><title type="html">The Power of .ini Files with configparser in Python: A Superior Alternative to .env Files</title><link href="http://localhost:4000/2023/06/14/The-Power-of-ini-Files-with-configparser-in-Python-A-Superior-Alternative-to-env-Files.html" rel="alternate" type="text/html" title="The Power of .ini Files with configparser in Python: A Superior Alternative to .env Files" /><published>2023-06-14T00:00:00+02:00</published><updated>2023-06-14T00:00:00+02:00</updated><id>http://localhost:4000/2023/06/14/The-Power-of-ini-Files-with-configparser-in-Python-A-Superior-Alternative-to-env-Files</id><content type="html" xml:base="http://localhost:4000/2023/06/14/The-Power-of-ini-Files-with-configparser-in-Python-A-Superior-Alternative-to-env-Files.html"><![CDATA[<h1 id="introduction">Introduction</h1>

<p>Configuration files are crucial in software development as they store essential parameters and settings that allow applications to function effectively in different environments. These files separate configuration variables from the code, offering flexibility, security, and ease of maintenance.</p>

<h2 id="importance-of-configuration-files">Importance of Configuration Files</h2>

<ol>
  <li><em>Separation of Concerns:</em> Configuration files isolate application logic from environment-specific details, promoting modularity and simplifying deployment and maintenance.</li>
  <li><em>Flexibility:</em> Configuration files enable easy adjustment of application behavior without code changes, facilitating adaptation to various environments.</li>
  <li><em>Security:</em> Sensitive information, like credentials, remains secure by storing it in configuration files instead of hard-coding it within the codebase.</li>
  <li><em>Collaboration:</em> Centralizing configuration variables in files enhances teamwork and allows efficient adjustments based on specific requirements.</li>
  <li><em>Maintainability:</em> Configuration files simplify updates and troubleshooting, making it easier to manage and modify variables when needed.</li>
</ol>

<h2 id="limitations-of-env-files">Limitations of <code class="language-plaintext highlighter-rouge">.env</code> files</h2>

<p>While .env files have gained popularity for storing configuration variables, they do have limitations and challenges that developers should be aware of:</p>

<ol>
  <li><em>Limited Data Types:</em> .env files primarily support string values, which can be limiting when working with configuration variables that require different data types, such as integers, booleans, or complex structures. Converting and parsing values from strings to the desired data type can be cumbersome and error-prone.</li>
  <li><em>Lack of Structure:</em> .env files lack a built-in structure for organizing configuration variables. As the number of variables grows, maintaining organization and readability becomes increasingly challenging. Developers often resort to naming conventions or comments to provide some level of organization, but this approach is not standardized or enforced.</li>
  <li><em>Absence of Hierarchy:</em> .env files lack a hierarchical structure, making it difficult to group related variables together or define subsections. This can result in a flat and cluttered configuration file, especially when managing multiple environments or complex settings.</li>
  <li><em>Limited Validation and Error Handling:</em> .env files do not provide inherent validation or error handling mechanisms. It is the responsibility of the developer to ensure the correctness and integrity of the variables. Without proper validation, itâ€™s possible to introduce errors or inconsistencies that can cause application failures or unexpected behavior.</li>
</ol>

<p>Considering these limitations and challenges, developers often seek alternatives like .ini files with <em>configparser</em> in Python, which offer a more robust and structured approach to configuration management. In the following sections, weâ€™ll explore the advantages of using .ini files and <em>configparser</em>, addressing these limitations and providing a superior solution for configuration handling in Python.</p>

<h1 id="introducing-ini-files-and-configparser">Introducing <code class="language-plaintext highlighter-rouge">.ini</code> files and configparser</h1>

<p>.ini files are configuration files with a specific structure and syntax. They consist of sections, keys, and values. Hereâ€™s a simple example:</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># config.ini</span>

<span class="nn">[section1]</span>
<span class="py">key1</span> <span class="p">=</span> <span class="err">value</span><span class="mi">1</span>
<span class="py">key2</span> <span class="p">=</span> <span class="err">value</span><span class="mi">2</span>

<span class="nn">[section2]</span>
<span class="py">key3</span> <span class="p">=</span> <span class="err">value</span><span class="mi">3</span>
<span class="py">key4</span> <span class="p">=</span> <span class="err">value</span><span class="mi">4</span>
</code></pre></div></div>

<p>In Python, the <strong><code class="language-plaintext highlighter-rouge">configparser</code></strong> module can be used to read values from .ini files. Hereâ€™s a minimal code example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">configparser</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="p">.</span><span class="nc">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">'</span><span class="s">config.ini</span><span class="sh">'</span><span class="p">)</span>

<span class="n">value1</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key1</span><span class="sh">'</span><span class="p">)</span>
<span class="n">value2</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key2</span><span class="sh">'</span><span class="p">)</span>
<span class="n">value3</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key3</span><span class="sh">'</span><span class="p">)</span>
<span class="n">value4</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key4</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>In this brief example, we import the <strong><code class="language-plaintext highlighter-rouge">configparser</code></strong> module, create a <strong><code class="language-plaintext highlighter-rouge">ConfigParser</code></strong> instance, and read the content of the <strong><code class="language-plaintext highlighter-rouge">config.ini</code></strong> file. We then retrieve values from specific sections and keys using the <strong><code class="language-plaintext highlighter-rouge">get()</code></strong> method.</p>

<h1 id="advantages-of-ini-files-with-configparser">Advantages of <code class="language-plaintext highlighter-rouge">.ini</code> files with configparser</h1>

<h2 id="simplicity-and-readability">Simplicity and Readability</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">configparser</span>

<span class="c1"># Read values from .ini file
</span><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="p">.</span><span class="nc">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">'</span><span class="s">config.ini</span><span class="sh">'</span><span class="p">)</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Modify values and write back to .ini file
</span><span class="n">config</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">'</span><span class="s">section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">new_value</span><span class="sh">'</span><span class="p">)</span>
<span class="n">config</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">config.ini</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">))</span>
</code></pre></div></div>

<p>In this example, we import the <strong><code class="language-plaintext highlighter-rouge">configparser</code></strong> module, create a <strong><code class="language-plaintext highlighter-rouge">ConfigParser</code></strong> instance, and read values from the <strong><code class="language-plaintext highlighter-rouge">config.ini</code></strong> file using the <strong><code class="language-plaintext highlighter-rouge">get()</code></strong> method.</p>

<p>To modify values, we use the <strong><code class="language-plaintext highlighter-rouge">set()</code></strong> method to update a specific key within a section. Then, we write the changes back to the .ini file using the <strong><code class="language-plaintext highlighter-rouge">write()</code></strong> method.</p>

<p><em>configparser</em> handles the complexities of parsing, accessing, modifying, and writing .ini files, simplifying the process for us (working with configuration values is hard enough as it is).</p>

<h2 id="hierarchical-structure">Hierarchical Structure</h2>

<p>.ini files can be organized into sections and subsections, providing a hierarchical structure for configuration variables.</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[section1]</span>
<span class="py">key1</span> <span class="p">=</span> <span class="err">value</span><span class="mi">1</span>
<span class="py">key2</span> <span class="p">=</span> <span class="err">value</span><span class="mi">2</span>

<span class="nn">[section2]</span>
<span class="py">key3</span> <span class="p">=</span> <span class="err">value</span><span class="mi">3</span>

<span class="nn">[sub_section]</span>
<span class="py">key4</span> <span class="p">=</span> <span class="err">value</span><span class="mi">4</span>
</code></pre></div></div>

<p>In this example, we have two sections, <strong><code class="language-plaintext highlighter-rouge">[section1]</code></strong> and <strong><code class="language-plaintext highlighter-rouge">[section2]</code></strong>. Additionally, there is a subsection <strong><code class="language-plaintext highlighter-rouge">[sub_section]</code></strong> nested within <strong><code class="language-plaintext highlighter-rouge">[section2]</code></strong>.</p>

<p>By organizing configuration variables into sections and subsections, we can easily group related variables together, improving clarity and organization.</p>

<p>To access <code class="language-plaintext highlighter-rouge">value4</code> , we then just need to write a few simple lines of code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">configparser</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="p">.</span><span class="nc">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">'</span><span class="s">config.ini</span><span class="sh">'</span><span class="p">)</span>

<span class="n">value4</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">section2.sub_section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key4</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="multiple-value-types">Multiple Value Types</h2>

<p><em>configparser</em> in Python supports various data types for configuration values, such as strings, integers, booleans, and floats.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value_int</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">getint</span><span class="p">(</span><span class="sh">'</span><span class="s">section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">)</span>
<span class="n">value_bool</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">getboolean</span><span class="p">(</span><span class="sh">'</span><span class="s">section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">)</span>
<span class="n">value_float</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">getfloat</span><span class="p">(</span><span class="sh">'</span><span class="s">section</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>By using the appropriate <strong><code class="language-plaintext highlighter-rouge">get</code></strong> methods provided by configparser (<strong><code class="language-plaintext highlighter-rouge">getint()</code></strong>, <strong><code class="language-plaintext highlighter-rouge">getboolean()</code></strong>, <strong><code class="language-plaintext highlighter-rouge">getfloat()</code></strong>), we can easily retrieve configuration values in the desired data type without the need for manual conversion. This flexibility in handling different data types simplifies the process of working with configuration variables of various types in Python applications.</p>

<h2 id="error-handling-and-validation">Error Handling and Validation</h2>

<p><em>configparser</em> in Python provides built-in error handling and validation mechanisms to ensure the correctness and integrity of configuration data. The main useful features could be sum up as follows:</p>

<ol>
  <li><em>Missing Section or Key Handling</em>: When accessing configuration values, configparser raises an error if a specified section or key is not found in the .ini file. This helps to catch and handle situations where expected configuration variables are missing.</li>
  <li><em>Syntax Error Detection</em>: configparser detects and reports syntax errors in .ini files. If the file has incorrect syntax or formatting, configparser raises an error indicating the location and nature of the syntax error. This aids in identifying and resolving syntax-related issues in configuration files.</li>
  <li><em>Type Conversion Errors</em>: As we said earlier in this article, <em>configparser</em> support typing verification. Thus, when using the specialized <strong><code class="language-plaintext highlighter-rouge">get</code></strong> methods (e.g., <strong><code class="language-plaintext highlighter-rouge">getint()</code></strong>, <strong><code class="language-plaintext highlighter-rouge">getboolean()</code></strong>, <strong><code class="language-plaintext highlighter-rouge">getfloat()</code></strong>), configparser automatically performs type conversions. If a configuration value cannot be converted to the requested type, configparser raises a type conversion error, preventing incorrect data usage.</li>
  <li><em>Duplicate Sections and Keys</em>: <em>configparser</em> ensures that sections and keys in .ini files are unique. If a duplicate section or key is encountered, configparser raises an error, preventing ambiguity or conflicts in configuration data.</li>
</ol>

<h1 id="practical-example-for-the-use-of-ini-files">Practical example for the use of <code class="language-plaintext highlighter-rouge">.ini</code> files</h1>

<p>For example, you could have at the root of your project two directories <code class="language-plaintext highlighter-rouge">properties</code> and <code class="language-plaintext highlighter-rouge">secrets</code>  as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>properties
â”œâ”€â”€ local.ini
â””â”€â”€ properties.ini
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>secrets
â”œâ”€â”€ local.ini
â””â”€â”€ secrets.ini
</code></pre></div></div>

<p>We just make a distinction for <em>properties</em> and <em>secrets</em> here but both folders refer configuration values.</p>

<p>In your <strong><code class="language-plaintext highlighter-rouge">properties/local.ini</code></strong> (values used for local work) you will have:</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[POSTGRES]</span>
<span class="py">postgres_username</span> <span class="p">=</span> <span class="err">postgres</span>
<span class="py">postgres_host</span> <span class="p">=</span> <span class="err">localhost</span>
<span class="py">postgres_port</span> <span class="p">=</span> <span class="mi">5432</span>
<span class="py">postgres_db</span> <span class="p">=</span> <span class="err">database</span>
</code></pre></div></div>

<p>In your <strong><code class="language-plaintext highlighter-rouge">properties/properties.ini</code></strong> (values used for production), you will have:</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[POSTGRES]</span>
<span class="py">postgres_username</span> <span class="p">=</span> <span class="err">%(POSTGRES_USER)s</span>
<span class="py">postgres_host</span> <span class="p">=</span> <span class="err">%(POSTGRES_HOST)s</span>
<span class="py">postgres_port</span> <span class="p">=</span> <span class="err">%(POSTGRES_PORT)s</span>
<span class="py">postgres_db</span> <span class="p">=</span> <span class="err">%(POSTGRES_DB)s</span>
</code></pre></div></div>

<blockquote>
  <p>ðŸ‘‰ This notation is called <strong>interporlation</strong> It tells <em>configparser</em> that â€œPOSTGRES_USERâ€ refers to either, another variable present in the <code class="language-plaintext highlighter-rouge">.ini</code> file or an environment variable.</p>

  <p>In the second case, to access that value in the code, you would need to call the variable as follows:</p>

  <p><code class="language-plaintext highlighter-rouge">config.get('POSTGRES', 'postgres_username', vars=os.environ)</code></p>
</blockquote>

<p>When you want to deploy your application on your server, you then, can set your <strong>environment variables values</strong> in you CI/CD (e.g. CircleCI) and create a script to export them on your server when deploying so that your code can access it.</p>

<h1 id="conclusion">Conclusion</h1>

<p><code class="language-plaintext highlighter-rouge">.env</code> files are convenient, for sure, as they are generally well implemented in many available frameworks. But <code class="language-plaintext highlighter-rouge">.ini</code> files offer a lot of powerful features, such as hierarchical structure, data validation, error handling, multiple value types, etcâ€¦</p>

<p>Those make the use of <code class="language-plaintext highlighter-rouge">.ini</code> files really intuitive and robust, that is why, I, as a software engineer advise people to use them.</p>

<p>The difference of use may appear insignificant, but those configuration values are, more often thant you think, the source of production regression. You may forget to set a value ? Or more subtil, you may set <code class="language-plaintext highlighter-rouge">"5432"</code> instead of <code class="language-plaintext highlighter-rouge">5432</code> as your database port value ?</p>

<p>Being an effective developer is about reducing, as much as possible, our feedback loop. When something is not supposed to work, we appreciate knowing it as soon as possible and <code class="language-plaintext highlighter-rouge">.ini</code> features such as <em>data validation</em> (among others) could make a difference in your development efficiency.</p>]]></content><author><name></name></author><category term="configuration" /><category term="python" /><summary type="html"><![CDATA[Configuration files are crucial in software development as they store essential parameters and settings that allow applications to function effectively in different environments. These files separate configuration variables from the code, offering flexibility, security, and ease of maintenance.]]></summary></entry><entry><title type="html">Junior developer: the importance of learning good development and architecture practices</title><link href="http://localhost:4000/2023/05/15/Junior-developer-the-importance-of-learning-good-development-and-architecture-practices.html" rel="alternate" type="text/html" title="Junior developer: the importance of learning good development and architecture practices" /><published>2023-05-15T00:00:00+02:00</published><updated>2023-05-15T00:00:00+02:00</updated><id>http://localhost:4000/2023/05/15/Junior-developer-the-importance-of-learning-good-development-and-architecture-practices</id><content type="html" xml:base="http://localhost:4000/2023/05/15/Junior-developer-the-importance-of-learning-good-development-and-architecture-practices.html"><![CDATA[<h1 id="introduction">Introduction</h1>

<p>As a junior developer, when we think about training we usually focus on learning all the technologies and programming languages that exist. Indeed, we
think that knowing as much technology as we can makes us more valuable on the employment market. Of course, it is not completely wrong as you will
able to cover a wider spectrum of knowledge making you â€œavailableâ€ for a lot of projects. Yet, in my experience, I would say that, this is not the
smartest or most optimized choice.</p>

<p>My name is Dorian Frances, I am a Software Engineer at Symeo for almost a year now and I will explain to you, through my personal experience as a
junior developer, why you should focus your training on learning good development and architecture design practices instead of technologies and
programming languages.</p>

<h1 id="betting-on-your-carrier">Betting on your carrier</h1>

<p>I told you that knowing a lot of technologies could be an advantage on the employment market and that is true. The question is: <strong>Is it worth spending
that much time trying to learn all those programming languages theories instead of the fundamentals of clean architecture and clean code ?</strong> You
learned 5 different technologies, thatâ€™s good, but will you use them in your projects ? Maybe or maybe not.</p>

<p>With code architecture, you donâ€™t even need to ask. There is code design in every single project. When you were at school, before a test, did you
prioritize learning potential questions or those that you were sure were in that test ?</p>

<p>Finally, profiles with good knowledge of architectural design are increasingly sought after. If the code that a developer produce do not fit great
architectural conventions or code quality, it will need to be reviewed, slowing down the delivery of a project. Depending on the progress of the
project, that could cost a lot of money and companies start to understand this.</p>

<h1 id="a-technical-learning-logic">A technical learning logic</h1>

<p>By this title, I mean that it makes more sense to learn good architectural design practices <strong>before</strong> focusing on learning too much technologies and
Iâ€™ll explain why.</p>

<p>First, by putting architecture design aside, you will pick up bad habits without even knowing it and that is natural. Even more if by misfortune, your
first companies are not cautious about good practices. And you know how hard it is to forget our bad practices right ?</p>

<p>Also, do not forget that technologies and programming languages are <strong>tools</strong>. And like all tools, they should be used to serve a
greater purpose: <strong>your project</strong>. You wont contradict me if I say that it is preferable to understand when and why we should use a tool before
starting to use it, right ? How could we possibly know which tool to use in order to build a house if we do not know how this house will look like,
the layout of the different rooms, its toughness ? IT projects are exactly the same, the architecture of your code is the layout and plans of your
house, the technologies, your tools. You may be hired inside a company to take care and develop only one part of the code base but as a developer, you
are responsible of the entire project.</p>

<blockquote>
  <p>ðŸ‘‰ This is a fundamental key of a concept called <strong>agility</strong>.</p>
</blockquote>

<p>Finally, you may ask yourself : â€œbut what if I am being assigned a mission that requires the knowledge of a programming language that I donâ€™t haveâ€ ?
You are right, that can be unsettled. Yet, Iâ€™ll respond to you: once you understood the code architecture, the learning process of that programming
language will be way more efficient. Indeed, you may not understand some part of the code but the simple act of understanding why this part of the
code is here, you will know what it <strong>should</strong> <strong>do</strong>. And this, will help you out.</p>

<h1 id="a-business-challenge">A business challenge</h1>

<p>Nowadays, a good developer cannot ignore the close link existing between tech and business (at least if you want to be part of a promising project).
Learning to understand quickly the structure of the code base will help you to assimilate the business of your company. Also, educating yourself to
concept like <strong>Hexagonal Architecture</strong> or <strong>Domain Driven Development</strong> is an efficient way to learn how to spot features that need special
attention.</p>

<blockquote>
  <p>ðŸ‘‰ <strong>Disclaimer</strong>: all the code that a developer writes needs to be worked on but for features that do not bring significant gain, your company might as well invest in tools that has already been created for.</p>
</blockquote>

<p>Arriving in a project with understanding of the entire architecture allows you to have a more enlightened vision on the decisions that are made and
you will only be happier inside the company.</p>

<h1 id="personal-experience">Personal experience</h1>

<p>Before arriving to Symeo, I was on an internship as a software engineer inside a company not very cautious about architecture design and good
development practices were not implemented. Therefore, each time I was trying to develop something, I ran into questions like: â€œWhere should I put
that code ?â€, â€œHow could I make this work without breaking everything ?â€.</p>

<p>At this time, I didnâ€™t even know tests existed. I was slowed down in my work by not knowing the key concepts of code design and architecture.</p>

<p>When I arrived at Symeo through another internship, my mentors taught me a lot about those concepts. They prepared a list of resources (videos and
articles) talking about clean architecture, code quality, testing, craftmanshipâ€¦ We also did some sessions of pair programming which is an efficient
way to learn as the feedback loop is very small !</p>

<p>Simultaneously, I was working with them on our first product, on the backend side, coded in Java. For your information, I had never coded in this
programming language before, but as the code was well structured, well arranged, I could learn faster.</p>

<p>We then, changed our product (the backend was still coded in Java) and you know what ? It was not that hard to work on this new project. The business
was not the same, neither were the issues and yet, the structure was not totally unknown to me ! Thus, the business might have changed, our way of
working did not allowing us to deliver quickly.</p>

<p>Finally, we started another project which was coded in Typescript with NestJS as its framework and for me, back to an unknown programming language.
Still, I was not completely lost as we continued to apply good architectural and code quality practices. It not only allowed me to learn the
Typescript language, it also taught me how to use it <strong>well</strong>.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Trying to learn about a bunch of technologies and programming languages is not a bad things, on the contrary, it reflects your will to progress. I
wrote this article from the point of view of a junior developer based on my experience. We only talk about priorities here. If you ask me, i would say
that starting from general issues and going to the specific ones is the best and most optimized way to learn.</p>]]></content><author><name></name></author><category term="best practices" /><summary type="html"><![CDATA[Greetings, fellow junior developers! We all embark on our coding journeys with an insatiable thirst for knowledge, eagerly devouring every programming language and technology in our path. It's only natural to believe that the more technologies we master, the more valuable we become in the competitive job market. After all, versatility seems like the ultimate key to unlocking endless opportunities. But what if I told you there's a smarter and more optimized approach to reaching your career goals?]]></summary></entry><entry><title type="html">How to bootstrap a NestJS project using Clean Architecture</title><link href="http://localhost:4000/2023/05/11/How-to-bootstrap-a-NestJS-project-using-Clean-Architecture.html" rel="alternate" type="text/html" title="How to bootstrap a NestJS project using Clean Architecture" /><published>2023-05-11T00:00:00+02:00</published><updated>2023-05-11T00:00:00+02:00</updated><id>http://localhost:4000/2023/05/11/How-to-bootstrap-a-NestJS-project-using-Clean-Architecture</id><content type="html" xml:base="http://localhost:4000/2023/05/11/How-to-bootstrap-a-NestJS-project-using-Clean-Architecture.html"><![CDATA[<h1 id="introduction">Introduction</h1>

<p>Starting off on the wrong foot for a project can be very incapacitating and at the same time, there is no direct value for the client. In this article
you will learn how to put yourself (and your team) on the right track in order to start a project serenely. Indeed, the goal here is to set a solid
and modular code base architecture allowing you to produce quality code in order to enhance the productivity or your team.</p>

<blockquote>
  <p>ðŸ‘‰ Remember, <strong>quality</strong> implies <strong>efficiency</strong> !</p>
</blockquote>

<p>With this in mind, we will go through two major concepts :</p>

<ul>
  <li>Clean architecture</li>
  <li>Dependency injection</li>
</ul>

<h1 id="initialize-the-project">Initialize the project</h1>

<p>The first things we need to do is to create our project, thus, with <code class="language-plaintext highlighter-rouge">npm</code> installed you can create you new NestJS project with the following
commands :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">-g</span> @nestjs/cli
nest new project-name
</code></pre></div></div>

<p>After that, NestJS will generate your project that will contain dist, node_modules and several other classic files of a project. Initially, your <code class="language-plaintext highlighter-rouge">src</code>
folder will look like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
â”œâ”€â”€ app.controller.spec.ts
â”œâ”€â”€ app.controller.ts
â”œâ”€â”€ app.module.ts
â”œâ”€â”€ app.service.ts
â””â”€â”€ main.ts
</code></pre></div></div>

<h1 id="clean-architecture">Clean architecture</h1>

<h3 id="structure">Structure</h3>

<p>In order to build a project that will fit clean architecture principles, in most cases, hexagonal architecture with <strong>Domain-Driven-Development</strong> (
DDD) is welcome. Indeed, it allows us to isolate our business code making it independent from the different technical implementations (databases,
external APIs, etcâ€¦) that may need to change.</p>

<p>Therefore, at the end, we want our structure to look as the following diagram:</p>

<p><img src="/assets/images/architecture-1.jpg" alt="architecture-1.jpg" /></p>

<p>Our <code class="language-plaintext highlighter-rouge">src</code> folder will then, look like this (we moved the <code class="language-plaintext highlighter-rouge">.spec.*</code> file into the <code class="language-plaintext highlighter-rouge">/test</code> folder as we prefer to have all our tests in it):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
â”œâ”€â”€ application
â”‚Â Â  â””â”€â”€ rest-api-adapter
â”‚Â Â      â”œâ”€â”€ controller
â”‚Â Â       Â Â  â””â”€â”€ app.controller.ts
â”œâ”€â”€ bootstrap
â”‚Â Â  â””â”€â”€ app.module.ts
â”œâ”€â”€ domain
â”‚Â Â  â””â”€â”€ app.service.ts
â”œâ”€â”€ infrastructure
â”‚Â Â  â””â”€â”€ postgres-adapter
â”‚Â Â      â”œâ”€â”€ adapter
â”‚Â Â       Â Â  â””â”€â”€ postgres.adapter.ts
â””â”€â”€ main.ts
</code></pre></div></div>

<h2 id="example-of-a-feature">Example of a feature</h2>

<p>We now have the basic structure of our project but letâ€™s say we want to add a feature that allows us to retrieve a user based on its <code class="language-plaintext highlighter-rouge">id</code> thanks to
a <code class="language-plaintext highlighter-rouge">Rest API</code> from a <code class="language-plaintext highlighter-rouge">postgresSQL</code> database. How should this look like ?</p>

<h3 id="designing-our-feature">Designing our feature</h3>

<p>We talked earlier about technical implementations on which our business logic (domain) should not be dependent of. In our case, our technical
implementations are :</p>

<ul>
  <li>The Rest API</li>
  <li>The postgreSQL database</li>
</ul>

<p>This is the reason why we will move those elements inside packages that are called <strong>adapters</strong> and we will connect them to our domain through
interfaces named <strong>ports</strong>.</p>

<p>The architecture of ou project will then look like this:</p>

<p><img src="/assets/images/architecture-2.jpg" alt="architecture-2.jpg" /></p>

<p>That way, if at some point in the life of the project, we would come up with the idea to change the database, we would just have to create a new
adapter with a new port and connect everything to our domain without having to change our business code (domain).</p>

<p>Now, the structure of our code looks like this (with a bit of renaming to fit our use case):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
â”œâ”€â”€ application
â”‚Â Â  â””â”€â”€ rest-api-adapter
â”‚Â Â      â”œâ”€â”€ controller
â”‚Â Â      â”‚Â Â  â””â”€â”€ user.controller.ts
â”‚Â Â      â””â”€â”€ dto
â”‚Â Â          â”œâ”€â”€ get-user.dto.ts
â”‚Â Â          â””â”€â”€ user.dto.ts
â”œâ”€â”€ bootstrap
â”‚Â Â  â”œâ”€â”€ app.module.ts
â”‚Â Â  â”œâ”€â”€ rest-api-adapter.module.ts
â”‚Â Â  â”œâ”€â”€ domain.module.ts
â”‚Â Â  â””â”€â”€ postgres-adapter.module.ts
â”œâ”€â”€ domain
â”‚Â Â  â”œâ”€â”€ model
â”‚Â Â  â”‚Â Â  â””â”€â”€ user.model.ts
â”‚Â Â  â”œâ”€â”€ port
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ in
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ user.facade.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ out
â”‚Â Â  â”‚Â Â      â””â”€â”€ user.storage.port.ts
â”‚Â Â  â””â”€â”€ service
â”‚Â Â      â””â”€â”€ user.service.ts
â”œâ”€â”€ infrastructure
â”‚Â Â  â””â”€â”€ postgres-adapter
â”‚Â Â      â”œâ”€â”€ adapter
â”‚Â Â      â”‚Â Â  â””â”€â”€ postgres.user.adapter.ts
â”‚Â Â      â”œâ”€â”€ entity
â”‚Â Â      â”‚Â Â  â””â”€â”€ user.entity.ts
â”‚Â Â      â””â”€â”€ ormconfig.ts
â””â”€â”€ main.ts
</code></pre></div></div>

<p>We still have our 4 main directories (application, domain, infrastructure and boostrap). We see our <code class="language-plaintext highlighter-rouge">rest-api-adapter</code> which will contain our
controllers and DTOs, our domain containing our models, our ports (in order to discuss with technical dependencies) and our services where we can put
our business logic inside. We also notice our <code class="language-plaintext highlighter-rouge">postgres-adapter</code> . For the purpose of this example, we used <a href="https://typeorm.io/">TypeORM</a> to manage
our database.</p>

<p><strong>Controllers</strong></p>

<p>For our case, the <code class="language-plaintext highlighter-rouge">user.controller.ts</code> looks as follows:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Controller</span><span class="p">,</span> <span class="nx">Get</span><span class="p">,</span> <span class="nx">Inject</span><span class="p">,</span> <span class="nx">Param</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">GetUserDTO</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../dto/get-user.dto</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserFacade</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../domain/port/in/user.facade</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users</span><span class="dl">'</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="p">{</span>
    <span class="nf">constructor</span><span class="p">(</span>
        <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="dl">'</span><span class="s1">UserFacade</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">userFacade</span><span class="p">:</span> <span class="nx">UserFacade</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">:userId</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">async</span> <span class="nf">getUser</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">userId</span><span class="dl">'</span><span class="p">)</span> <span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">GetUserDTO</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userFacade</span><span class="p">.</span><span class="nf">getUserById</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">GetUserDTO</span><span class="p">.</span><span class="nf">fromDomain</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We pass the interface <code class="language-plaintext highlighter-rouge">UserFacade</code> inside the container of our controller as a dependency.</p>

<p><strong>Services</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">user.service.ts</code> looks like this:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">UserFacade</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../port/in/user.facade</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">User</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../model/user.model</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserStoragePort</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../port/out/user.storage.port</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="k">implements</span> <span class="nx">UserFacade</span> <span class="p">{</span>
    <span class="nf">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">userStoragePort</span><span class="p">:</span> <span class="nx">UserStoragePort</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nf">getUserById</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">userStoragePort</span><span class="p">.</span><span class="nf">getUserById</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
        <span class="cm">/*
        Manipulating the object (Business Logic)
         */</span>
        <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By passing to our service a simple interface (<code class="language-plaintext highlighter-rouge">UserStoragePort</code>), we make it independent. The service, which is part of our domain, just retrieves an
object from an implementation without knowing which one (in that case, our <code class="language-plaintext highlighter-rouge">postgres-adapter</code> ). Then we can manipulate this object and return it to
our <code class="language-plaintext highlighter-rouge">rest-api-adapter</code>.</p>

<blockquote>
  <p>ðŸ‘‰ We clearly see that if we decide to change our database or our API for anything else, it will not affect our business code at any time.</p>
</blockquote>

<h3 id="creating-our-local-database">Creating our local database</h3>

<p>For this example, we will create our database using <code class="language-plaintext highlighter-rouge">docker-compose</code> .</p>

<p>At the root of your folder, you will add a <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file with the following content:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.2'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">database</span><span class="pi">:</span>
    <span class="na">platform</span><span class="pi">:</span> <span class="s">linux/amd64</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres:13"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example-container"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=postgres</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=P@ssw0rd</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=example-database</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
</code></pre></div></div>

<p>You then can launch your local database with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up
</code></pre></div></div>

<h1 id="dependency-injection">Dependency injection</h1>

<p>If we try to launch our application in its current state, it wonâ€™t work. Indeed we still have to write our dependency injections. That is the purpose
of the <code class="language-plaintext highlighter-rouge">bootstrap</code> folder. NestJS works with <a href="https://docs.nestjs.com/modules">modules</a>. We will have an <em>AppModule</em> (which should have been generated
at initialization). This is the first module that will be imported at runtime by our <code class="language-plaintext highlighter-rouge">main.ts</code> file.</p>

<blockquote>
  <p>ðŸ‘‰ <strong>Important</strong> : The concept of clean architecture involves a very powerful notion which is <strong>dependency inversion</strong> that makes our domain only
dependent on abstractions (interfaces). Consequently, this increase the modularity of our code and makes it way more testable.</p>
</blockquote>

<p>Back to our project, if we take the example of our <code class="language-plaintext highlighter-rouge">domain.module.ts</code> to see how we make our dependency injections, we see this:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Module</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">PostgresAdapterModule</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./postgres-adapter.module</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserStoragePort</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../domain/port/out/user.storage.port</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserService</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../domain/service/user.service</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">UserFacadeProvider</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">provide</span><span class="p">:</span> <span class="dl">'</span><span class="s1">UserFacade</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="na">userStoragePort</span><span class="p">:</span> <span class="nx">UserStoragePort</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">new</span> <span class="nc">UserService</span><span class="p">(</span><span class="nx">userStoragePort</span><span class="p">),</span>
    <span class="na">inject</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">PostgresUserAdapter</span><span class="dl">'</span><span class="p">],</span>
<span class="p">};</span>

<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">PostgresAdapterModule</span><span class="p">],</span>
    <span class="na">providers</span><span class="p">:</span> <span class="p">[</span><span class="nx">UserFacadeProvider</span><span class="p">],</span>
    <span class="na">exports</span><span class="p">:</span> <span class="p">[</span><span class="nx">UserFacadeProvider</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nc">DomainModule</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We import inside the <code class="language-plaintext highlighter-rouge">DomainModule</code> the <code class="language-plaintext highlighter-rouge">PostgresAdapterModule</code> in order to provide the implementation to our <code class="language-plaintext highlighter-rouge">UserStoragePort</code> that is used inside
our service (i.e the <code class="language-plaintext highlighter-rouge">PostgresUserAdapter</code> here).</p>

<p>We then export the entire DomainModule in order to be able to use it inside our <code class="language-plaintext highlighter-rouge">RestApiAdapterModule</code> as follows:</p>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Module</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">DomainModule</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./domain.module</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">UserController</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../application/rest-api-adapter/controller/user.controller</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">DomainModule</span><span class="p">],</span>
    <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">UserController</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nc">RestApiAdapterModule</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As it is the module of our Rest API, this is where we import our <em>controllers</em>.</p>

<p>For the postgres-adapter module to work properly, it remains to configure TypeORM but I leave it to you to do so by using the
official <a href="https://docs.nestjs.com/techniques/database">documentation of NestJS</a>.</p>

<h1 id="conclusion">Conclusion</h1>

<p>If you followed the steps of this article and been able to start your application properly, you should now have a project with a clean architecture
that will allow you to build modular applications. Besides, your business code wonâ€™t be dependent on your choices of implementation allowing you to
make mistakes (yes it happens).</p>]]></content><author><name></name></author><category term="bootstrap" /><category term="architecture" /><summary type="html"><![CDATA[Starting off on the wrong foot for a project can be very incapacitating, and at the same time, it offers no direct value for you. In this article, I'll try to show you how you can put yourself (and your team) on the right track to begin a project with confidence. The goal here is to help you establish a solid and modular code base architecture using the NestJS template, enabling you to produce quality code and enhance your team's productivity.]]></summary></entry></feed>